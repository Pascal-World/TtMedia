<!DOCTYPE html>
<html>
  <head>
    <title>Form Data Storage</title>
    <style>
      table {
        border-collapse: collapse;
      }

      table,
      th,
      td {
        border: 1px solid black;
        padding: 5px;
      }

      .action-buttons {
        display: flex;
        justify-content: center;
      }

      .action-buttons button {
        margin: 2px;
      }
    </style>
  </head>
  <body>
    <h2>Form Data Storage</h2>

    <form id="myForm">
      <label for="name">Name:</label>
      <input type="text" id="name" required /><br />

      <label for="email">Email:</label>
      <input type="email" id="email" required /><br />

      <label for="phone">Phone:</label>
      <input type="tel" id="phone" required /><br />

      <label for="boundary">Boundary:</label>
      <select name="boundary" id="">
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>
      <br />

      <button type="submit" id="submitButton">Submit</button>
      <button type="button" onclick="resetForm()">Reset</button>
    </form>

    <h2>Stored Data</h2>

    <table id="dataTable">
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Actions</th>
      </tr>
    </table>

    <div id="exportButtons">
      <button onclick="exportAsText()">Save as Text</button>
      <button onclick="exportAsPDF()">Save as PDF</button>
    </div>

    <script>
      var selectedRowIndex = -1; // Track the selected row index for editing

      // Function to handle form submission
      // Function to handle form submission
      function handleSubmit(event) {
        event.preventDefault(); // Prevent form submission

        // Get form values
        var name = document.getElementById("name").value;
        var email = document.getElementById("email").value;
        var phone = document.getElementById("phone").value;

        if (selectedRowIndex === -1) {
          // If no row is selected, insert a new row
          var table = document.getElementById("dataTable");
          var newRow = table.insertRow();

          // Insert cell values into the new row
          var cell1 = newRow.insertCell(0);
          cell1.innerHTML = name;

          var cell2 = newRow.insertCell(1);
          cell2.innerHTML = email;

          var cell3 = newRow.insertCell(2);
          cell3.innerHTML = phone;

          var cell4 = newRow.insertCell(3);
          cell4.innerHTML =
            '<div class="action-buttons"><button onclick="editRow(this)">Edit</button><button onclick="deleteRow(this)">Delete</button><button onclick="saveAsText(this)">Save as Text</button><button onclick="saveAsPDF(this)">Save as PDF</button></div>';
        } else {
          // If a row is selected, update the row values
          var table = document.getElementById("dataTable");
          var row = table.rows[selectedRowIndex];

          row.cells[0].innerHTML = name;
          row.cells[1].innerHTML = email;
          row.cells[2].innerHTML = phone;

          // Reset selectedRowIndex
          selectedRowIndex = -1;

          // Change submit button text back to "Submit"
          document.getElementById("submitButton").textContent = "Submit";
        }

        // Clear form values
        document.getElementById("myForm").reset();

        // Save data to local storage
        saveDataToLocalStorage();
      }

      // Function to save data to local storage
      function saveDataToLocalStorage() {
        var data = [];

        // Retrieve all rows from the table
        var table = document.getElementById("dataTable");
        var rows = table.rows;

        // Skip the first row (header row)
        for (var i = 1; i < rows.length; i++) {
          var row = rows[i];
          var rowData = {
            name: row.cells[0].innerHTML,
            email: row.cells[1].innerHTML,
            phone: row.cells[2].innerHTML,
          };

          data.push(rowData);
        }

        // Convert the data to JSON and save it in local storage
        localStorage.setItem("formData", JSON.stringify(data));
      }

      // Function to load data from local storage
      function loadDataFromLocalStorage() {
        var data = localStorage.getItem("formData");
        if (data) {
          data = JSON.parse(data);

          // Insert rows into the table based on the data
          var table = document.getElementById("dataTable");

          data.forEach(function (rowData) {
            var newRow = table.insertRow();

            var cell1 = newRow.insertCell(0);
            cell1.innerHTML = rowData.name;

            var cell2 = newRow.insertCell(1);
            cell2.innerHTML = rowData.email;

            var cell3 = newRow.insertCell(2);
            cell3.innerHTML = rowData.phone;

            var cell4 = newRow.insertCell(3);
            cell4.innerHTML =
              '<div class="action-buttons"><button onclick="editRow(this)">Edit</button><button onclick="deleteRow(this)">Delete</button><button onclick="saveAsText(this)">Save as Text</button><button onclick="saveAsPDF(this)">Save as PDF</button></div>';
          });
        }
      }

      // Load data from local storage when the page is loaded
      window.addEventListener("DOMContentLoaded", loadDataFromLocalStorage);

      // Function to handle edit button click
      function editRow(button) {
        var row = button.parentNode.parentNode.parentNode;
        var rowIndex = row.rowIndex;

        selectedRowIndex = rowIndex;

        var name = row.cells[0].innerHTML;
        var email = row.cells[1].innerHTML;
        var phone = row.cells[2].innerHTML;

        // Set form values with the selected row data
        document.getElementById("name").value = name;
        document.getElementById("email").value = email;
        document.getElementById("phone").value = phone;

        // Change submit button text to "Update"
        document.getElementById("submitButton").textContent = "Update";
      }

      // Function to handle delete button click
      function deleteRow(button) {
        var row = button.parentNode.parentNode.parentNode;
        var rowIndex = row.rowIndex;

        // Delete the row
        document.getElementById("dataTable").deleteRow(rowIndex);

        // Remove the corresponding data from local storage
        removeDataFromLocalStorage(rowIndex - 1); // Subtract 1 to account for the header row
      }

      // Function to remove data from local storage
      function removeDataFromLocalStorage(index) {
        var data = localStorage.getItem("formData");
        if (data) {
          data = JSON.parse(data);

          // Remove the data at the specified index
          data.splice(index, 1);

          // Update the data in local storage
          localStorage.setItem("formData", JSON.stringify(data));
        }
      }

      // Function to save row data as text
      function saveAsText(button) {
        var row = button.parentNode.parentNode.parentNode;
        var rowData = {
          name: row.cells[0].innerHTML,
          email: row.cells[1].innerHTML,
          phone: row.cells[2].innerHTML,
        };

        var rowText = `Name: ${rowData.name}
Email: ${rowData.email}
Phone Number: ${rowData.phone}`;

        download(rowText + "\n", "data.txt");
      }

      // Function to save row data as PDF
      function saveAsPDF(button) {
        var row = button.parentNode.parentNode.parentNode;
        var rowData = {
          name: row.cells[0].innerHTML,
          email: row.cells[1].innerHTML,
          phone: row.cells[2].innerHTML,
        };

        var rowText = `Name: ${rowData.name}
Email: ${rowData.email}
Phone Number: ${rowData.phone}`;

        var docDefinition = {
          content: [
            { text: "Stored Data", style: "header" },
            { text: rowText },
          ],
        };

        pdfMake.createPdf(docDefinition).download("Proforma.pdf");
      }

      // Function to download text as a file
      function download(content, filename) {
        var element = document.createElement("a");
        element.setAttribute(
          "href",
          "data:text/plain;charset=utf-8," + encodeURIComponent(content)
        );
        element.setAttribute("download", filename);

        element.style.display = "none";
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
      }

      // Function to reset the form
      function resetForm() {
        selectedRowIndex = -1;
        document.getElementById("myForm").reset();
        document.getElementById("submitButton").textContent = "Submit";
      }

      // Add event listener for form submission
      document
        .getElementById("myForm")
        .addEventListener("submit", handleSubmit);
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/vfs_fonts.js"></script>
  </body>
</html>
